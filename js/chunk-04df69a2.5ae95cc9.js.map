{"version":3,"sources":["webpack:///./src/views/articles/canvas/chapterC02P05.vue?9958","webpack:///./src/views/articles/canvas/chapterC02P05.vue?4dfa","webpack:///./src/views/articles/canvas/chapterC02P05.vue?f7ca","webpack:///./src/views/articles/canvas/chapterC02P05.vue?6467","webpack:///./src/views/articles/canvas/chapterC02P05.vue?35ea"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","ref","attrs","class","active","eraserEnabled","on","brushHandler","eraserHandler","downloadHandler","clearHandler","lineWidth","$event","_l","color","key","strokeStyle","style","backgroundColor","setColor","staticRenderFns","extend","data","canvas","ctx","colorList","mounted","getCanvasAndContext","initCanvasBackground","disableScroll","registerUserEvents","methods","$refs","getContext","Error","drawLine","x1","y1","x2","y2","beginPath","moveTo","lineTo","stroke","closePath","enableDrag","lastPoint","x","y","undefined","document","body","ontouchstart","addEventListener","e","offsetX","offsetY","clearRect","newPoint","touches","clientX","clientY","downloadImage","filename","a","createElement","href","download","target","appendChild","click","width","height","dataURL","toDataURL","changeCtxStrokeStyle","fillStyle","fillRect","preventDefault","component"],"mappings":"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","file":"js/chunk-04df69a2.5ae95cc9.js","sourcesContent":["export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./chapterC02P05.vue?vue&type=style&index=0&id=31d75f4f&lang=less&scoped=true&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"demo-whiteboard\"},[_c('canvas',{ref:\"canvas\",attrs:{\"width\":\"400\",\"height\":\"400\"}}),_c('div',{staticClass:\"actions\"},[_c('svg',{staticClass:\"icon\",class:{ active: !_vm.eraserEnabled },on:{\"click\":_vm.brushHandler}},[_c('use',{attrs:{\"xlink:href\":\"#icon-Pencil\"}})]),_c('svg',{staticClass:\"icon\",class:{ active: _vm.eraserEnabled },on:{\"click\":_vm.eraserHandler}},[_c('use',{attrs:{\"xlink:href\":\"#icon-eraser\"}})]),_c('svg',{staticClass:\"icon\",on:{\"click\":_vm.downloadHandler}},[_c('use',{attrs:{\"xlink:href\":\"#icon-save\"}})]),_c('svg',{staticClass:\"icon\",on:{\"click\":_vm.clearHandler}},[_c('use',{attrs:{\"xlink:href\":\"#icon-clear\"}})])]),_c('ul',{staticClass:\"sizes\"},[_c('li',{staticClass:\"size thin action-item\",class:{ active: _vm.lineWidth === 3 },on:{\"click\":function($event){_vm.lineWidth = 3}}}),_c('li',{staticClass:\"size thick action-item\",class:{ active: _vm.lineWidth === 6 },on:{\"click\":function($event){_vm.lineWidth = 6}}})]),_c('ul',{staticClass:\"colors\"},_vm._l((_vm.colorList),function(color){return _c('li',{key:color,staticClass:\"color action-item\",class:{\n        active: color === _vm.strokeStyle\n      },style:({ backgroundColor: color }),on:{\"click\":function($event){return _vm.setColor(color)}}})}),0)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/* eslint-disable no-param-reassign */\nimport Vue from 'vue';\n\nexport default Vue.extend({\n  data() {\n    return {\n      eraserEnabled: false,\n      lineWidth: 3,\n      strokeStyle: '',\n      canvas: null as HTMLCanvasElement | null,\n      ctx: null as CanvasRenderingContext2D | null,\n      colorList: ['#000000', '#70FF56', '#FB6164', '#FFE931', '#83FFB6', '#FF7520'],\n    };\n  },\n  mounted() {\n    const { canvas, ctx } = this.getCanvasAndContext();\n    this.initCanvasBackground(canvas, ctx);\n    this.disableScroll();\n    this.registerUserEvents(canvas, ctx);\n  },\n  methods: {\n    getCanvasAndContext() {\n      const canvas = this.$refs.canvas as HTMLCanvasElement;\n      const ctx = canvas.getContext('2d');\n      if (!ctx) {\n        throw new Error('浏览器太非主流了吧');\n      }\n      this.canvas = canvas;\n      this.ctx = ctx;\n      return { canvas, ctx };\n    },\n\n    drawLine(ctx: CanvasRenderingContext2D, x1: number, y1: number, x2: number, y2: number) {\n      ctx.beginPath();\n      ctx.moveTo(x1, y1);\n      ctx.lineWidth = this.lineWidth || 3;\n      ctx.lineTo(x2, y2);\n      ctx.stroke();\n      ctx.closePath();\n    },\n\n    registerUserEvents(canvas: HTMLCanvasElement, ctx: CanvasRenderingContext2D) {\n      // 鼠标操作\n      let enableDrag = false;\n      let lastPoint = { x: 0, y: 0 };\n      // 特性检测\n      if (document.body.ontouchstart === undefined) {\n        // 非触屏设备\n        canvas.addEventListener('mousedown', (e) => {\n          enableDrag = true;\n          const x = e.offsetX;\n          const y = e.offsetY;\n          if (this.eraserEnabled) {\n            ctx.clearRect(x - 5, y - 5, 10, 10);\n          } else {\n            // 在按下时就要更新 lastPoint, 不然下一次点击会连接到上一条线的 lastPoint\n            lastPoint = { x, y };\n          }\n        });\n        canvas.addEventListener('mousemove', (e) => {\n          if (!enableDrag) { return; }\n\n          const x = e.offsetX;\n          const y = e.offsetY;\n          if (this.eraserEnabled) {\n            ctx.clearRect(x - 5, y - 5, 10, 10);\n          } else {\n            const newPoint = { x, y };\n            this.drawLine(ctx, lastPoint.x, lastPoint.y, newPoint.x, newPoint.y);\n            lastPoint = newPoint;\n          }\n        });\n        canvas.addEventListener('mouseup', (e) => {\n          enableDrag = false;\n        });\n      } else {\n        // 触屏设备\n        canvas.addEventListener('touchstart', (e) => {\n          enableDrag = true;\n          const x = e.touches[0].clientX;\n          const y = e.touches[0].clientY;\n          if (this.eraserEnabled) {\n            ctx.clearRect(x - 5, y - 5, 10, 10);\n          } else {\n            // 在按下时就要更新 lastPoint, 不然下一次点击会连接到上一条线的 lastPoint\n            lastPoint = { x, y };\n          }\n        });\n        canvas.addEventListener('touchmove', (e) => {\n          if (!enableDrag) { return; }\n\n          const x = e.touches[0].clientX;\n          const y = e.touches[0].clientY;\n          if (this.eraserEnabled) {\n            ctx.clearRect(x - 5, y - 5, 10, 10);\n          } else {\n            const newPoint = { x, y };\n            this.drawLine(ctx, lastPoint.x, lastPoint.y, newPoint.x, newPoint.y);\n            lastPoint = newPoint;\n          }\n        });\n        canvas.addEventListener('touchend', (e) => {\n          enableDrag = false;\n        });\n      }\n    },\n\n    // Save | Download image\n    downloadImage(data: string, filename = 'untitled.jpeg') {\n      const a = document.createElement('a');\n      a.href = data;\n      a.download = filename;\n      a.target = '_blank';\n      document.body.appendChild(a);\n      a.click();\n    },\n\n    eraserHandler() {\n      this.eraserEnabled = true;\n    },\n\n    brushHandler() {\n      this.eraserEnabled = false;\n    },\n\n    clearHandler() {\n      const { ctx, canvas } = this;\n      if (!ctx || !canvas) { return; }\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n    },\n\n    downloadHandler() {\n      const { ctx, canvas } = this;\n      if (!ctx || !canvas) { return; }\n      const dataURL = canvas.toDataURL('image/png');\n      this.downloadImage(dataURL, '我的画-在线画板.png');\n    },\n\n    setColor(color: string) {\n      this.strokeStyle = color;\n      if (this.ctx) {\n        this.changeCtxStrokeStyle(this.ctx, color);\n      }\n    },\n\n    changeCtxStrokeStyle(ctx: CanvasRenderingContext2D, color: string) {\n      ctx.strokeStyle = color;\n    },\n\n    initCanvasBackground(canvas: HTMLCanvasElement, ctx: CanvasRenderingContext2D) {\n      ctx.fillStyle = 'white';\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\n    },\n\n    disableScroll() {\n      document.body.addEventListener('touchmove', (e) => {\n        e.preventDefault();\n      });\n    },\n  },\n});\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/@vue/cli-plugin-typescript/node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./chapterC02P05.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/@vue/cli-plugin-typescript/node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./chapterC02P05.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./chapterC02P05.vue?vue&type=template&id=31d75f4f&scoped=true&\"\nimport script from \"./chapterC02P05.vue?vue&type=script&lang=ts&\"\nexport * from \"./chapterC02P05.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./chapterC02P05.vue?vue&type=style&index=0&id=31d75f4f&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"31d75f4f\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}